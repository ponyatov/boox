\secrel{Optimizing the Design}\label{warren5}\secdown

Now that the reader is hopefully convinced that the design we have reached forms
an adequate target language and architecture for compiling pure Prolog, we can
begin transforming it in order to recover Warrenâ€™s machine as an ultimate design.
Therefore, since all optimizations considered here are part of the definitive design,
we shall now refer to the abstract machine gradually being elaborated as the WAM.
In the process, we shall abide by a few principles of design pervasively motivating
all the conception features of the WAM. We will repeatedly invoke these principles
in design decisions as we progress toward the full WAM engine, as more evidence
justifying them accrues.

\textsc{WAM PRINCIPLE 1} Heap space is to be used as sparingly as possible, as
terms built on the heap turn out to be relatively persistent.

\textsc{WAM PRINCIPLE 2} Registers must be allocated in such a way as to avoid
unnecessary data movement, and minimize code size as well.

\textsc{WAM PRINCIPLE 3} Particular situations that occur very often, even
though correctly handled by general-case instructions, are to be accommodated by special
ones if space and/or time may be saved thanks to their specificity.

In the light of WAM Principles 1, 2, and 3, we may now improve on M.

\paragraph{Figure 5.1: Better heap representation for term pZ hZW f W}
\begin{verbatim}

h
 REF 
 REF
 f 
 REF
 p
 REF 
 STR
 STR
\end{verbatim}

\input{prolog/warren/51heap}
\input{prolog/warren/52const}
\input{prolog/warren/53note}
\input{prolog/warren/54regalloc}
\input{prolog/warren/55lastcall}
\input{prolog/warren/56chain}
\input{prolog/warren/57env}
\input{prolog/warren/58stack}
\input{prolog/warren/59var}
\input{prolog/warren/5Aindexing}
\input{prolog/warren/5Bcut}

\secup
